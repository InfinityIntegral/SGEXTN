@SG_ML_COMMENT This SGML documentation file is automatically generated by _ocu_mentation, the 05524F internal documentation generation app.
@SG_ML_PAGENAME Full Tutorial Part 15
@SG_ML_TITLE Full Tutorial Part 15
@SG_ML_BLANKLINE
&#9;See @SG_ML_L004006herefull14 for the previous part of the tutorial.
&#9;In the previous part, we wrote code to save user defined preset options for our application.
@SG_ML_BLANKLINE
@SG_ML_HEADER_ using saved user data
&#9;Next we will be implementing the UI page that allows users to select and use presets.
&#9;This will need a new UI page, so we will create a new class, SGCLPPresetsSelectionPage. By now you should already know how to do this.
&#9;As usual, we will declare these stuff
@SG_ML_WARN static SGWBackground* instance;&#10;static SGWBackground* initialise();&#10;static void activate();
&#9;Remember to forward declare the @SG_ML_L00D019SGWBackground../cppclass/sgwbackground class instead of including the header file. Also remember to add the source file into the CMakeLists.txt
@SG_ML_BLANKLINE
&#9;For this page, we can have a scroll view filling almost the entire screen, leaving a bit of space for a cancel button at the bottom of the page. The buttons to select presets would be listed in order inside the scroll view.
&#9;Since we will need to add stuff into the scroll view, we will need to store a pointer to it also. We also need to declare a function for the cancel button that disables the UI page.
@SG_ML_WARN static SGWWidget* listBackground;&#10;static void cancelPresetSelection();
&#9;We then can implement SGCLPPresetsSelectionPage::initialise, SGCLPPresetsSelectionPage::activate, and SGCLPPresetsSelectionPage::cancelPresetSelection.
@SG_ML_WARN SGWBackground* SGCLPPresetsSelectionPage::initialise(){&#10;    SGWBackground* bg = new SGWPageBackground(SGWWidget::parentWidget, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 8);&#10;    SGCLPPresetsSelectionPage::listBackground = new SGWScrollView(bg, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f, 1.0f, -1.0f, 0.0f, 0.0f, 0.0f, 0.5f, 8);&#10;    new SGWTextButton(bg, "cancel", &SGCLPPresetsSelectionPage::cancelPresetSelection, 0.0f, 0.0f, 1.0f, -1.0f, 1.0f, 0.0f, 0.0f, 1.0f);&#10;    return bg;&#10;}&#10;&#10;void SGCLPPresetsSelectionPage::activate(){&#10;    SGWBackground::enable(SGCLPPresetsSelectionPage::instance, &SGCLPPresetsSelectionPage::initialise, nullptr);&#10;}&#10;&#10;void SGCLPPresetsSelectionPage::cancelPresetSelection(){&#10;    SGWBackground::disable(SGCLPPresetsSelectionPage::instance);&#10;}
&#9;After that we can modify the code that creates the "use preset" button in SGCLPOptionsPage::initialise to make the button run SGCLPPresetsSelectionPage::activate. You should already know how to do this.
&#9;Note that currently the height of the scroll view is always a @SG_ML_L01A016w-distance ⁽㈳㈴㈳㈮㈱㈨㈠㈫ ㈧㈤㈱㈤⁾../tutorials/wdistance of (0.0, 0.0), which always resolves to 0 pixels. This will be dynamically determined when the buttons are actually placed into the scroll view.
&#9;Testing shows that the page appears when the "use preset" button is pressed, and when the "cancel" button inside the page is pressed, it disappears as expected.
@SG_ML_BLANKLINE
&#9;Next we can actually add the buttons to choose a preset.
&#9;To do that, we simply look through the list of files in the folder and for every file, we make a button for it. We then resize the scroll view appropriately and put all the buttons inside.
&#9;When a button is clicked, it has to run a @SG_ML_L021015callback function ⁽㈳㈴㈳㈮㈱㈨㈠㈫ ㈧㈤㈱㈤⁾../tutorials/callback that sets the presets to whatever stored in the file. This means we need the path to the file.
&#9;This can be done by storing the path in @SG_ML_L01902FSGWButton::attachedString../cppclass/sgwbutton#SGXString_attachedString_, which is automatically passed to @SG_ML_L02204BSGWButton::clickFunctionWithString../cppclass/sgwbutton#void_ptr_clickFunctionWithString_const_SGXString_ref_ when the button is clicked.
&#9;We can define the function
@SG_ML_WARN static void useSavedPreset(const SGXString& filePath);
&#9;Then we modify the implementation of SGCLPPresetsSelectionPage::initialise and write the implementation of SGCLPPresetsSelectionPage::useSavedPreset as below.
@SG_ML_WARN SGWBackground* SGCLPPresetsSelectionPage::initialise(){&#10;    SGWBackground* bg = new SGWPageBackground(SGWWidget::parentWidget, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 8);&#10;    SGWScrollView* scrollView = new SGWScrollView(bg, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f, 1.0f, -1.0f, 0.0f, 0.0f, 0.0f, 0.5f, 8);&#10;    SGCLPPresetsSelectionPage::listBackground = scrollView;&#10;    new SGWTextButton(bg, "cancel", &SGCLPPresetsSelectionPage::cancelPresetSelection, 0.0f, 0.0f, 1.0f, -1.0f, 1.0f, 0.0f, 0.0f, 1.0f);&#10;    SGLArray&lt;SGXString&gt; filesList = SGXFileSystem::getFilesListWithExtension(SGXFileSystem::userDataFilePath, "sg");&#10;    (*scrollView).setI0(static_cast&lt;float&gt;(filesList.length()));&#10;    for(int i=0; i&lt;filesList.length(); i++){&#10;        SGWButton* button = new SGWTextButton(scrollView, SGXFileSystem::getFileNameNoExtension(filesList.at(i)), nullptr, 0.0f, 0.0f, 0.0f, static_cast&lt;float&gt;(i), 1.0f, 0.0f, 0.0f, 1.0f);&#10;        (*button).attachedString = filesList.at(i);&#10;        (*button).clickFunctionWithString = &SGCLPPresetsSelectionPage::useSavedPreset;&#10;    }&#10;    return bg;&#10;}&#10;&#10;void SGCLPPresetsSelectionPage::useSavedPreset(const SGXString &filePath){&#10;    SGXFile file(filePath, SGXFile::ReadOnly);&#10;    SGCLPOptionsPage::chosenForegroundColour = file.readColourRGBA();&#10;    SGCLPOptionsPage::chosenBackgroundColour = file.readColourRGBA();&#10;    int patternIndex = file.readInt();&#10;    if(patternIndex == 1){SGCLPOptionsPage::chosenPattern = SGCLPOptionsPage::Circle;}&#10;    else if(patternIndex == 2){SGCLPOptionsPage::chosenPattern = SGCLPOptionsPage::Polygon;}&#10;    else if(patternIndex == 3){SGCLPOptionsPage::chosenPattern = SGCLPOptionsPage::Star;}&#10;    else{SGCLPOptionsPage::chosenPattern = SGCLPOptionsPage::Fractal;}&#10;    SGCLPOptionsPage::chosenVertexCount = file.readInt();&#10;    SGWBackground::disable(SGCLPPresetsSelectionPage::instance);&#10;    SGWBackground::disable(SGCLPOptionsPage::instance);&#10;    SGCLPDisplayPage::activate();&#10;}
&#9;Since we have not actually really built the display page yet, it is impossible to confirm if this actually works. However we do observe that when a preset is selected, both the preset selection page and the options page turn off, while the display page turns on. This is expected behaviour, so we will assume everything is good for now.
@SG_ML_BLANKLINE
&#9;With another major feature completed, we can perform a clang-tidy scan and commit the changes to GitHub. By now you should know how to do this.
@SG_ML_BLANKLINE
&#9;See @SG_ML_L004006herefull16 for the next part of the tutorial.
&#9;
