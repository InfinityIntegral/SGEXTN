@SG_ML_COMMENT This SGML documentation file is automatically generated by _ocu_mentation, the 05524F internal documentation generation app.
@SG_ML_PAGENAME Full Tutorial Part 13
@SG_ML_TITLE Full Tutorial Part 13
@SG_ML_BLANKLINE
&#9;See @SG_ML_L004006herefull12 for the previous part of the tutorial.
&#9;In the previous part, we scanned our code using clang-tidy and committed to GitHub
@SG_ML_BLANKLINE
@SG_ML_HEADER_ building the progress bar
&#9;The display page will show whatever pattern you chose in the options page for 10 seconds before going back to the options page for you to choose another pattern. During that 10 seconds, there will be a progress bar at the top of the display page to show how much time is left. In this part of the tutorial, we will be building the progress bar.
&#9;We need to declare a variable inside include/SGCLPDisplayPage.h for the progress bar widget.
&#9;Since we need to wait for 10 seconds before turning off the display page and we need to update the progress bar every second, we will need a @SG_ML_L008014SGXTimer../cppclass/sgxtimer instance and a int keeping track of the time already passed. That will need to be declared also. Additionally we need to declare the function that the @SG_ML_L008014SGXTimer../cppclass/sgxtimer runs automatically.
@SG_ML_WARN static int time;&#10;static SGXTimer* timer;&#10;static SGWWidget* progressBar;&#10;static void updateProgressBar();
&#9;We can modify the existing implementation of SGCLPDisplayPage::initialise to create the progress bar and start the timer.
@SG_ML_WARN SGWBackground* SGCLPDisplayPage::initialise(){&#10;    SGWBackground* bg = new SGWPageBackground(SGWWidget::parentWidget, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f);&#10;    SGCLPDisplayPage::time = 0;&#10;    SGCLPDisplayPage::progressBar = new SGWBlankWidget(bg, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 0.0f, 1.0f);&#10;    (*SGCLPDisplayPage::progressBar).setThemeColour(5);&#10;    SGCLPDisplayPage::timer = new SGXTimer(1.0f, &SGCLPDisplayPage::updateProgressBar);&#10;    return bg;&#10;}
&#9;And then inside the SGCLPDisplayPage::updateProgressBar function which the timer calls every second, we can update the progress bar and turn off the page when time is up. When this page is disabled, we send the user back to the options page.
@SG_ML_WARN void SGCLPDisplayPage::updateProgressBar(){&#10;    SGCLPDisplayPage::time++;&#10;    (*SGCLPDisplayPage::progressBar).setW1(static_cast&lt;float&gt;(SGCLPDisplayPage::time) / 10.0f);&#10;    if(SGCLPDisplayPage::time == 10){&#10;        SGCLPDisplayPage::time = 0;&#10;        (*SGCLPDisplayPage::timer).deleteTimer();&#10;        SGCLPDisplayPage::progressBar = nullptr;&#10;        SGCLPDisplayPage::timer = nullptr;&#10;        SGWBackground::disable(SGCLPDisplayPage::instance);&#10;        SGCLPOptionsPage::activate();&#10;    }&#10;}
&#9;Again, we are using @SG_ML_L01A016w-distance ⁽㈳㈴㈳㈮㈱㈨㈠㈫ ㈧㈤㈱㈤⁾../tutorials/wdistance and @SG_ML_L016044SGWBackground::disable../cppclass/sgwbackground#static_void_disable_SGWBackground_ptr_ref_ (opposite of @SG_ML_L01506CSGWBackground::enable../cppclass/sgwbackground#static_void_enable_SGWBackground_ptr_ref_SGWBackground_ptr_ptr_func_void_ptr_func_) here.
&#9;Note how instead of directly deleting the timer object, we call @SG_ML_L01502BSGXTimer::deleteTimer../cppclass/sgxtimer#void_deleteTimer_func_ on it. This is because directly deleting it will lead to a use after free bug which is @SG_ML_L01301Fundefined behaviour../tutorials/undefinedbehaviour, so to prevent it, a runtime error will be thrown if you try. @SG_ML_L01502BSGXTimer::deleteTimer../cppclass/sgxtimer#void_deleteTimer_func_ is the safe way to delete it.
&#9;Testing through the UI a few times would reveal that it actually works.
&#9;Now that the progress bar is done, we can commit our work onto GitHub.
@SG_ML_WARN git add .&#10;git commit -m "done progress bar"&#10;git push
@SG_ML_BLANKLINE
&#9;See @SG_ML_L004006herefull14 for the next part of the tutorial.
&#9;
