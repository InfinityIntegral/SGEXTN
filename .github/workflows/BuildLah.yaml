name: BuildLah cross platform build and package workflow

on:
  workflow_call:
    inputs:
      app-name:
        required: true
        description: name of your application executable, example my-application
        type: string
      app-version:
        required: true
        description: version number of your application, example 1.0.0
        type: string
      qt-version:
        required: true
        description: version of Qt to use, it is preferred that this matches the Qt version you have on your development machine, example 6.10.1
        type: string
      cmake-target-name:
        required: true
        description: name of CMake target for your application executable, this is used to locate the executable, the executable will be renamed after that
        type: string
      user-facing-app-name:
        required: true
        description: application name as how you want the user to see it, this does not need to be a valid file name, example My Application
        type: string
      user-facing-app-version:
        required: true
        description: application version as how you want the user to see it, this does not need to be numerical, example version 1.0.0
        type: string
      app-icon:
        required: true
        description: location of the application icon PNG image as a path in your GitHub repository, example assets/icon.png
        type: string
      user-facing-organisation-name:
        required: true
        description: your organisation name as how you want the user to see it, example 05524F.sg
        type: string
      bundle-id:
        required: true
        description: application bundle identifier, only used on MacOS, iOS, and Android, must be a reverse URL style dot separated list, with every entry containing only lowercase letters and numbers and must start with a lowercase letter, example sg.singapore05524f.myapplication
        type: string
      app-category:
        required: true
        description: one from the list AudioVideo, Audio, Video, Development, Education, Game, Graphics, Network, Office, Science, Settings, System, Utility, only used on Linux, example Utility
        type: string
      licensing:
        required: true
        description: software licensing for your application, you are strongly recommended to use General Public License version 3 (GPLv3), the license file from your GitHub repository will always be copied regardless of this input, example GPLv3
        type: string
      license-file:
        required: true
        description: path to the license file in your GitHub repository, typically LICENSE.txt, example LICENSE.txt
        type: string
      app-description:
        required: true
        description: a short explanatory note to the user what the app is about
        type: string
      platforms:
        required: true
        description: space separated list of platforms to build for paired with compiler to use, each job in this workflow corresponds to a supported platform, example linux-gcc windows-llvm-mingw
        type: string

jobs:
  linux-gcc:
    if: ${{contains(format(' {0} ', inputs.platforms), ' linux-gcc ')}}
    runs-on: ubuntu-22.04
    steps:
      - name: Linux GCC build
        uses: InfinityIntegral/SGEXTN/actions/linux_gcc_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  macos-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' macos-clang ')}}
    runs-on: macos-latest
    steps:
      - name: MacOS Clang build
        uses: InfinityIntegral/SGEXTN/actions/macos_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  windows-llvm-mingw:
    if: ${{contains(format(' {0} ', inputs.platforms), ' windows-llvm-mingw ')}}
    runs-on: windows-latest
    steps:
      - name: Windows LLVM MinGW build
        uses: InfinityIntegral/SGEXTN/actions/windows_llvm_mingw_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  windows-mingw:
    if: ${{contains(format(' {0} ', inputs.platforms), ' windows-mingw ')}}
    runs-on: windows-latest
    steps:
      - name: Windows MinGW build
        uses: InfinityIntegral/SGEXTN/actions/windows_mingw_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  windows-msvc:
    if: ${{contains(format(' {0} ', inputs.platforms), ' windows-msvc ')}}
    runs-on: windows-latest
    steps:
      - name: Windows MSVC build
        uses: InfinityIntegral/SGEXTN/actions/windows_msvc_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  windows-arm-msvc:
    if: ${{contains(format(' {0} ', inputs.platforms), ' windows-arm-msvc ')}}
    runs-on: windows-11-arm
    steps:
      - name: Windows ARM MSVC build
        uses: InfinityIntegral/SGEXTN/actions/windows_arm_msvc_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  linux-arm-gcc:
    if: ${{contains(format(' {0} ', inputs.platforms), ' linux-arm-gcc ')}}
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Linux ARM GCC build
        uses: InfinityIntegral/SGEXTN/actions/linux_arm_gcc_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  android-arm64-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' android-arm64-clang ')}}
    runs-on: ubuntu-latest
    steps:
      - name: Android ARM64 Clang build
        uses: InfinityIntegral/SGEXTN/actions/android_arm64_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  android-arm32-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' android-arm32-clang ')}}
    runs-on: ubuntu-latest
    steps:
      - name: Android ARM32 Clang build
        uses: InfinityIntegral/SGEXTN/actions/android_arm32_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  android-amd64-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' android-amd64-clang ')}}
    runs-on: ubuntu-latest
    steps:
      - name: Android AMD64 Clang build
        uses: InfinityIntegral/SGEXTN/actions/android_amd64_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  android-amd32-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' android-amd32-clang ')}}
    runs-on: ubuntu-latest
    steps:
      - name: Android AMD32 Clang build
        uses: InfinityIntegral/SGEXTN/actions/android_amd32_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  android-aab-clang:
    if: ${{contains(format(' {0} ', inputs.platforms), ' android-aab-clang ')}}
    runs-on: ubuntu-latest
    steps:
      - name: Android AAB Clang build
        uses: InfinityIntegral/SGEXTN/actions/android_aab_clang_build@main
        with:
          app-name: ${{inputs.app-name}}
          app-version: ${{inputs.app-version}}
          qt-version: ${{inputs.qt-version}}
          cmake-target-name: ${{inputs.cmake-target-name}}
          user-facing-app-name: ${{inputs.user-facing-app-name}}
          user-facing-app-version: ${{inputs.user-facing-app-version}}
          app-icon: ${{inputs.app-icon}}
          user-facing-organisation-name: ${{inputs.user-facing-organisation-name}}
          bundle-id: ${{inputs.bundle-id}}
          app-category: ${{inputs.app-category}}
          licensing: ${{inputs.licensing}}
          license-file: ${{inputs.license-file}}
          app-description: ${{inputs.app-description}}

  pull-source:
    runs-on: ubuntu-latest
    steps:
      - name: Pull source
        uses: InfinityIntegral/SGEXTN/actions/pull_source@main
        with:
          qt-version: ${{inputs.qt-version}}
